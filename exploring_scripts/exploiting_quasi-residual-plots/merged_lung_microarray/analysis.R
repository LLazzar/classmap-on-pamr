clinical=read.table("sample_datasets/merged_lung_microarray/E-MTAB-6043.sdrf.txt", sep = "\t", header = TRUE)
datar=read.table("sample_datasets/merged_lung_microarray/Combat_filtered_exprs.txt", sep = "\t", header = TRUE)

col=colnames(datar)
clinical_ordered <- clinical[order(match(clinical$Characteristics.GEO.sample.accession., col)),]
clinical_ordered <- data.frame(clinical_ordered, row.names = NULL) #reset index

clinical_ordered <- subset(clinical_ordered, Characteristics.disease.histology. %in% c("normal histology", "squamous cell carcinoma histology", "large cell carcinoma histology", "adenocarcinoma histology"))
dat=datar[,clinical_ordered$Characteristics.GEO.sample.accession.]

colnames(dat)[845]
clinical_ordered$Characteristics.GEO.sample.accession.[845] #ok they matchdata:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAC80lEQVR42u2Wy2sTURTG+wf4QFEwBbFKKbgQFy6SoGJFatUsXGmRbtRqE9TUmcGmSEKNpqFRtMlIjE1EsLGQKNZW+ojgVkEqiI2tuFAER0YtpMnUhtiQ9nq/hEhoJtM8uhIvHGa4c+f85pw557u3qur/oGO92rhmk4Y9rtKwPLWQSsON0+srlZobxByeYU3FoA27TaurNYyx9oAl3Nw+KFy5+17ig9/nPU+lRWdgZsHq+5owOsLSEcOAsLXeHMbassH46i17TRN6a0j0j86k/KE48T6bI67Hv8iN/lli75NI1wOJ2KhdvS8Rk3s6ddgwIm7eY5rAuyXBqrVsy06dfap3QEgEXsRJ79AccTycJRZfjJjuxAh3O0pYPpq+XnLTOU+MdHgy8y22z4m6hq4p+CgOpmaP7tDZJvtGp5P9z+PkVnCWmL0ZZ4wrSi4WMIbPfATu9Y5vydqGa5PwpQjbWH9uFdLofvQlDhhSh4gYvjCokJ20fowjvaiDwtFpuLbWzjERaeyhkSFVjKt0WNYOtg6L8CkLW7erYy2q0T8WTeGfmX3lRZZr52/+TNXUW8LwLRddU7NpUEA1dtMCwT+rBJa1/aeeCPCdB1RpWVenJyx5aXSoRsa1MsATl99KEId8IFUQPvgjiT5DoWBx6HWClDrwTi5Q7xCS8C0D5MahIKjM3HSWAl0Kgxl7IovwLRfhS2cgsgAFYZcUSzFQOZgyUMsOWe8JvyFXcgWjBC0EU04pLZoLjncStBFyJfeyHFQJplg0KF0dVf20EHtiBR3kQpeDKbYFmnMbbdJ2qvoQYqWmB6gYmGLjZ6XtkGFYzO4GlfagorRlN1wI7mnbp0SlMGxTy4p3euPVcse2N9o/GK6LyXJhBro9wUfRGzHtm7N1DfYpfGU5kWEDVmmYMyUfMZCSRv2IiJ9fTIFgbVlHjNzTGg5GNfvMYZQ3ekrfLcy3OSOLMNxjDs+wpqJDVD6Ya/p7TNSyb9KWPjKyPJ6tCOifGH8AFuwin+ZrRG0AAAAASUVORK5CYII=

data=list() #pamr wants list
data$y=as.matrix(clinical_ordered[,11])
data$x=as.matrix(dat)
str(data$x)
str(data$y)


table(data$y)
which(is.na(data$y))

#FITTING

library(pamr)

pamr=pamr.train(data)
thres=pamr.adaptthresh(pamr)
pamr=pamr.train(data, threshold.scale = thres)
pamr
pamrcv=pamr.cv(pamr, data)
pamrcv

rf=randomForest(data$y ~ ., data = t(data$x))

source("feature_code/R/VCR_pamr.R")

#VISUAL TOOLS

library(classmap)
vcrpamr=vcr.pamr.train(data,pamr, pamrfitcv=pamrcv, threshold=1.5)


silplot(vcrpamr)

classmap(vcrpamr, whichclass = 3)
